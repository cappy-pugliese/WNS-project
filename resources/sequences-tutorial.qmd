---
title: "Downloading and Processing Sequences"
format: pdf
editor: visual
---

## Using SRA toolkit to download files

-   create data working directory

-   preset download to working directory

    `vdb-config --prefetch-to-cwd`

-   download the file

    `prefetch [SRA-id-number]`

## FastQC

-   use fasterq-dump to extract the file

    `fasterq-dump [SRA-id-number] --split-files`

    `fastqc --noextract [fastq-split-file-1] [fastq-split-file-2] [...]`

## Trimming seq with bbduk

``` bash
bbduk.sh in1=SRR11812088_1.fastq in2=SRR11812088_2.fastq out1=SRR11812088_1.trimmed.fastq out2=SRR11812088_2.trimmed.fastq t=10 qtrim=rl maq=10 ftl=10 ftr=-139 trimq=15 tpe tbo
```

## Mapping seq to genome

using bwa mem

```         
bwa mem -t 8 pdestructans.fasta SRR11812088_1.trimmed.fastq SRR11812088_2.trimmed.fastq | samtools sort -@8 -o SRR11812088-take3.bam
```

## Editing bam file

```         
java -jar /isg/shared/apps/picard/picard-tools-2.9.2/picard.jar AddOrReplaceReadGroups \
      I=SRR11812088.bam \
      O=SRR11812088.named.bam \
      RGID=1 \
      RGLB=lib1 \
      RGPL=ILLUMINA \
      RGPU=unit1 \
      RGSM=test
```

```         
java -jar /isg/shared/apps/picard/picard-tools-2.9.2/picard.jar MarkDuplicates \
I=SRR11812088.named.bam \
O=SRR11812088.dedup.bam \
M=dedup.txt
```

```         
samtools sort SRR11812088.dedup.bam -o SRR11812088.sorted.bam

samtools index SRR11812088.sorted.bam
```

## Calling genotypes

using bcftools

```         
bcftools mpileup SRR11812088.sorted.bam --fasta-ref p_dest.fna | bcftools call -m --ploidy 1 -Oz -o test.g.vcf.gz
```

-   looks like its not able to open up the Pd-ref-genome file

-   i might have to redownload the reference genome and redo up until this point- I don't know if something is wrong with the file or there's something wrong with the file name??

![](../images/mpileup-error.png){style="color: black" width="600"}
